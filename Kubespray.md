#Kubespray#

kubernetes the hard way - for learning.

Kubespray - подходит как для развёртывания на облачных технологиях, так и на своём железе.

Kubespray - не лучшее решение, поскольку сконструирован на Ansible и при большом количестве серверов сценарий может выполняться до 5-6 часов.

Kubespray позволяет:
1. Установить кластер Kubernetes актуальной версии.
2. Установить готовое контейнерное решение, сетевое решение, кластер Etcd: все те компоненты, которые необходимы для работы кластера Kubernetes.
3. Установить дополнительные компоненты: DNS, ingress-control, cert-manager'ы, интеграцию с сетевыми системами хранения данных, но на боевых средах лучше использовать установку дополнительных компонентов другими средствами.
Поскольку если вы что-то установите дополнительно Kubespray'ем, то и обновлять это нужно будет через Kubespray, а значит - запускать его весь и прогонять все сценарии.
4. Добавлять новые ноды в кластер.
5. Обновлять версию кластера.

Документация Kubespray'a:
https://github.com/kubernetes-sigs/kubespray

Копируем директорию с гита на первый мастер.
Переходим в директорию **kubespray/**
Основной файл c playbook'ом для Kubespray называется **cluster.yaml**
В этом файле находится список тех ролей, которые Kubespray будет последовательно применять на наши ноды для установки кластера.

Проверяем версию Ansible.
Если используем прокси хост, проверяем настройки для прокси-хоста.
Проводим первичную настройку операционной системы.
Собираем факты с наших нод.
Подготовительные действия по установке кластера kubernetes, подключаем и устанавливаем container-engine.
Устанавливаем кластер ETCD (2 роли, работает либо одна, либо другая).
Устанавливаем, настраиваем и подготавливаем для деплоя кубернетесовские ноды.
Устанавливаем control-plane компоненты кластера: kube api server, controller manager scheduler, генерировать для них сертификаты, генерировать их манифесты, конфигурации; генерировать клиентские сертификаты и доступы к кластеру.
Настраиваем с помощью утилиты kubeadm сами ноды кластера kubernetes и вводить их в кластер, подключать сетевой плагин для нашего кластера kubernetes.
**Погуглить что такое Calico Route Reflector** + https://habr.com/ru/company/flant/blog/485716/
небольшой лайфхак для того, чтобы работать с Windows-нодами.
Настраиваем дополнительные компоненты для кластера kubernetes: external_cloud_controller, policy_controller, ingress_controller, etc.
В завершении устанавливаем и настраиваем кластерный DNS.
#ВОТ ТУТ ВСЁ РАСПИСАТЬ НАПРОЧЬ ПРЯМО СЮДА ПРИ ПРАКТИКЕ#

3.4.
