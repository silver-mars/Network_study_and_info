**План**
* Типы серверов: Snowflake vs. Phoenix
* Модели управления инфраструктурой
* Инфраструктурная модель Base-Service-App
* Работа с образами VM: base image, bake vs fry, immutable infrastructure
* Сервисные модели: pets vs cattle
* Работа с Packer

При ручной установке и конфигурации выше шанс совершить ошибки.

**Сервера Snowflake** - ручные изменения, которые мы вносим на сервера приводят к тому, что наша инфраструктура и сервера становятся похожи на снежинки:
уникальны,
сложны для понимания,
хрупки и
неповторимы.

Мы точно не можем понять что именно позволяет им работать так, как они работают сейчас. Поэтому эти сервера очень легко могут поломаться, если в конфигурации что-то случилось. Из-за того, что настройки постоянно меняются очень сложно обновлять данные, wiki по ним и т. д.

**Сервера Phoenix**
Фаулер: "Сервер должен быть как феникс, регулярно восставая из пепла".

**Модели и методы управления инфраструктурой**

**Модели управления инфраструктурой**
**Divergence** - расхождение.
Когда есть желаемое состояние системы (target) и актуальное (actual).
В тот момент, когда мы всё настроили, target and actual is equialent.
Но после того, как люди начинают заходить на сервера, менять настройки, вносить изменения и делать это вручную, то state нашего состояние если нигде не хранится, то мы получаем модель divergence.

**Convergence** - схождение.
Смысл такой же (target and actual) - есть сервер, и есть инструменты, типа ansible or terraform, когда мы постепенно и последовательно, благодаря декларативно описанному инструментарию, мы приводим систему в целевое состояние, описанное в виде кода.
Здесь также может быть расхождение в итоге, поскольку кто-то может ходить по ssh на сервер и вносить ручные изменения.
Расхождение между target and actual называется **конфигурационным дрифтом**.
Чем чаще мы прогоняем сценарии, плэйбуки и т. д., тем ближе target and actual.

**Congruence** - соответствие.
Наше актуальное и целевое состояние идут рядом, практически совпадая (за исключением логов, временных папок и т. д.)
Immutable infrastructure, вроде контейнеров докера.

**Методы управления инфраструктурой**
* Manual
что приводит к серверам snowflake
* Scripts
настройки становятся задокументированы (можем всё вложить в один скрипт, начало процесса автоматизации)
* Infrastructure as a Code (IaC)
инструменты типа ansible, terraform, которые позволяют описывать желаемое состояние системы декларативно
* Immutable Infrastructure
Позволяет создавать неизменяемые образы, которые уже можно доставлять до production. Например, артефакты
* Immutable Delivery
Работа с контейнеризированными приложениями, позволяет создавать среду запуска приложений от разработки до production в неизменяемом виде

Чтобы эффективно управлять инфраструктурой, нужно иметь определённый взгляд на неё
**Base-Service-App модель**
**Application**
Производимые продукты, приносящие прибыль компании либо имеющие внутреннюю ценность для её работы.
**Service**
Поддерживающие сервисы, требуемые для работы приложений.
**Base**
Настроенная операционная система, отвечающая предъявленным требованиям, и поддерживающая инфраструктура.

29:04



