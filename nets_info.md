**Топология сети** - это схема соединения компьютеров в сети.
Представляется в виде графа, где:
Узлы - это вершины (Узлами называют копьютеры и сетевое оборудование).
Рёбра - связь между узлами.

Различают следующие виды топологии:
Полносвязная
Ячеистая (как полносвязная, но некоторые связи удалены)
Звезда (все узлы связаны с центральным устройством)
Кольцо
Дерево
Общая шина
Смешанная топология

# Виды топологии
**Физическая топология** - соединения устройств в сети.
**Логическая топология** - правила распространения сигналов в сети.

Примеры:
классический **Ethernet** имеет физическую топологию **звездв**, поскольку компьютеры подключаются к центральному узлу, но логическую топологию **общая шина**, потому что данные, поступающие на один порт концентратора распространяются на все доступные порты и доступно всем компьютерам в сети.
Коммутируемый **Ethernet** имеет такую же физическую топологию, но логически - **полносвязную**: каждый компьютер может быть соединён напрямую с другим компьютером.
Технология **Wi-Fi** не имеет физическую топологию, а логическую топологию - **общая шина**. Всё, что узел передаёт в радиоэфир доступно всем другим компьютерам, находящимся в зоне действия отправителя.

# Виды стандартов в компьютерных сетях
**De jure** (формальные, юридические) - принятые по формальным законам стандартизации.
Примеры:
ISO (эталонная модель взаимодействия открытых систем),
IEEE (технологии передачи данных, сетевое оборудование),
IAB (протоколы интернет),
W3C (стандарты Web).
Доступны здесь: **https://www.w3.org/standards/**
**De facto** (фактические) - установившиеся сами собой (новые технологии, пользующиеся большой популярностью).

Нас интересует **Internet Engineering Task Force, IETF**, выпускающий стандарты на сетевые протоколы.
он пишет **Request for comments (RFC)** - запросы на комментарии. Содержат в себе:
Документы с описанием работы протоколов
(Формально не называются стандартами (запрос комментариев), но по сути являются таковыми.
Примеры документов:
RFC 791 - протокол IP
RFC 793 - протокол TCP
https://tools.ietf.org/rfc/index

#Основы организации компьютерных сетей

h1. Сложности построения сетей:
Многообразие оборудования и ПО
Надёжность
Развитие сети
Распределение ресурсов
Качество обслуживания
Безопасность

h1. Решение:
Декомпозиция на отдельные подзадачи
Каждый уровень решает одну конкретную задачу или набор связанных задач
Изоляция работ различных уровней

Набор необходимых понятий:
**Сервис** - описывает функционал уровня
**Интерфейс** - набор примитивных операций, которые нижний уровень предоставляет верхнему
Использует реальное взаимодействие внутри компьютера
(Уровень N вызывает уровень N - 1 внутри одного компьютера)
**Протокол** - правила и соглашения, используемые для связи уровня N одного компьютера с уровнем N другого компьютера.
Использует виртуальное взаимодействие между компьютерами
(Реально соединяются друг с другом только уровни, работающие с физической средой)
Виртуальное взаимодействие происходит через заголовки протокола.

**Кратко:**<br>
Сервис - что делает уровень.<br>
Протокол - как уровень это делает.<br>
Интерфейс - как получить доступ к сервису уровня.<br>

**Архитектура сети**:
задаёт набор уровней и протоколов сети.
(Интерфейсы в архитектуру не входят, т. к. могут быть разные на разных программно-аппаратных платформах)

**Стек протоколов** - это иерархически организованный набор протоколов, достаточный для организации взаимодействия по сети.

**Инкапсуляция** - включение сообщения вышестоящего уровня в сообщение нижестоящего уровня.
Сообщение строится по типу: заголовок + данные + концевик (необязательный).

#Модель OSI
Это одна из эталонных моделей организации сети, решающая вопросы:
* Какие уровни долдны быть в сети?
* Какие функции должны выполняться на каждом уровне?

Модель OSI расшифровывается как Open System Interconnection (Модель взаимодействия открытых систем).

**Открытая система** - система, построенная в соответствии с открытыми спецификациями.
**Открытая спецификация** - общедоступная спецификация, соответствующая стандартам.

**Преимущества открытых систем**
* Возможность строить сети из оборудования разных производителей
* "Безболезненная" замена отдельных компонентов сети
* Лёгкость объединения нескольких сетей

Модель OSI используется в качестве "общего языка" для описания разных сетей
Включает 7 уровней организации сети и их назначение
(Протоколы не включены в модель)

<details>
    <summary>Уровни:</summary>
**Application**
Набор приложений
Единица передаваемых данных:
Сообщение
**Presentation**
Предоставлять данные в том виде, который понятен и отправителю, и получателю.
Обеспечивает согласование синтаксиса и семантики передаваемых данных.
* Форматы представления символов
* Форматы чисел
Шифрование и дешифрование
Examples: TLS, SSL
Единица передаваемых данных:
Сообщение
**Session**
Позволяет устанавливать сеансы связи
Задачи:
Управление диалогом (определяет очерёдность передачи сообщений)
Управление маркерами (предотвращение одновременного выполнения критичной операции, транзакции)
Синхронизация (защита от разрыва сетевого соединения и возможность возобновления передачи при восстановлении соединения)
Единица передаваемых данных:
Сообщение
**Transport**
Обеспечивает передачу данных между процессами на хостах
Единица передаваемых данных:
Сегмент/Дейтаграмма
**Network**
Объединяет сети, построенные на основе разных технологий
Задачи:
создание составной сети
Адресация,
**Маршрутизация** - определение маршрута пересылки пакетов в составной сети.
Единица передаваемых данных:
Пакет
**Data Link**
Передача сообщений: определение начала/конца сообщения в потоке бит
Физическая адресация
Единица передаваемых данных:
Кадр
**Physical**
передача битов по физическому каналу связи
Задача: представление бит информации в виде сигналов, передаваемых по среде
Единица передаваемых данных:
Бит
</details>

На разных уровнях модели OSI работает разное оборудование:
Сетевой - Маршрутизатор
Канальный - Коммутатор, точка доступа
Физический - Концентратор

#Модель TCP/IP
Фактический стандарт (de facto).

Прикладной
Транспортный
Интернет
Сетевых интерфейсов

Есть разновидность, известная как "Пятиуровневая модель OSI + TCP/IP":
Прикладной
Транспортный
Сетевой
Канальный
Физический

Описана у Таненбаума, Уэзеролла в книге "Компьютерные сети".
Считается что эта модель ближе всего к тому, что сейчас используется на практике.

#Физический уровень
**Сервис** - передача потока бит по среде передачи данных.
Не вникает в смысл передаваемой информации.
Единица передачи информации - бит.
**Основная задача** - зпредставить биты информации в виде сигналов, передаваемых по среде.
Различают следующие **характеристики канала связи**:
* **Пропускная способность** (бит/с)
* **Задержка** - за сколько времени сообщение доходит от отправителя до получателя
Совместно пропускная способность и задержка характеризуют **скорость работы канала**.
* **Количество ошибок**

**Типы каналов связи**:
* **Симплексный** - данные можно передавать только в одну сторону
* **Дуплексный** - данные можно передавать в обе стороны
* **Полудуплексный** - данные также можно передавать в обе стороны, но по очереди

**Среды передачи данных**
* Кабель:
Витая пара
Оптоволокно
Провода электропитания 220В и т. д.
* Беспроводные технологии:
Радиоволны
Инфракрасное излучение
* Спутниковые каналы
* Беспроводная оптика (лазеры)

**Особенности беспроводной сети**:
* Сигнал передаётся по нескольким направлениям
* Один и тот же сигнал могут принимать несколько приёмников
* Несколько источников сигнала искажают друг друга и требуют координации работы

Поэтому используемые диапазоны регулируются законодательством:
Пример:
Сотовая связь (GSM) - 900 МГц
Wi-Fi: 2,4 ГГц и 5 ГГц
Но другие приборы также работают на этой частоте. Поэтому роутер, расположенный рядом с микроволновкой - не очень хорошая идея.

Среда передачи данных   Частота возникновения ошибок
Оптические кабели       Очень редко
Медные кабели           Редко
Радиоволны              Часто

**Представление информации** также различается:
В медных проводах используется **кодирование**, т. н. прямоугольные импульсы
0 - отсутствие напряжения, 1 - напряжение, но на практике используются более сложные схемы.
**baseband modulation**

В оптоволокне и беспроводной среде используется **модуляция**, т. н. синусоидальные волны
**passband modulation**

#Физический уровень
**Основная задача** - передача сообщений по каналам связи - кадров (frame)
Также на этом уровне:
* определяется точка начала/конца кадра в потоке бит
* происходит обнаружение и коррекция ошибок

Если на канале связи есть несколько устройств, то здесь также решаются следующие вопросы:
* Адресация
* Согласованный доступ к каналу

Канальный уровень получает с сетевого уровня пакет данных.
Затем он добавляет к нему **Заголовок** и **Концевик**, формируя из пакета таким образом **кадр**.
Затем данное сообщение передаётся по среде передачи данных и поступает на канальный уровень принимающего хоста.
В результате на канальном уровне принимающего хоста расшифровываются Заголовок и Концевик и извлечённый **пакет данных** передаётся выше на сетевой уровень.

##Методы выделения кадров##

**Указатель количества байт**

Например, самый простой способ указать начало и конец кадра: в начале каждого кадра указывать его длину в байтах.
Другой метод - вставка в начало и конец каждого кадра особой последовательности байтов или бит, например:
**Протокол BSC** использует текстовые символы:
* DLE STX - начало кадра (Start of TeXt)
* DLE ETX - конец кадра (End of TeXt)
* Escape последовательность в данных - DLE (Data Link Escape)
**Протоколы HDLC и PPP** используют биты:
* 01111110 - начало и каонец кадра
* В данных после пяти последовательных единиц добавлялся 0 для избежания случайного совпадения в теле сообщения вышеупомянутой комбинации бит
* Получатель, в свою очередь после пяти последовательных единиц игнорировал 0

**bit/byte stuffing** (вставка битов/байтов)

**Средства физического уровня**
Преамбула (классический Ethernet)
* Длина 8 байт
* Первые 7 байт: 10101010
* Последний байт: 10101011 (ограничитель начала кадра)

Передача неиспользуемых символов избыточного кода (Fast Ethernet)
* Начало кадра - пара символы J (11000) и K (10001)
* Конец кадра - символ T (01101)

##Варианты обнаружения и исправления ошибок##
**Обнаружение ошибок:**
* Контрольная сумма
Самый простой способ - просто отбросить кадр с нарушенной контрольной суммой

**Исправление ошибок**
* Коды исправляющие ошибки (с избыточной информацией)
* Позволяют обнаруживать и исправлять ошибки

**Повторная отправка данных**
* Если в кадре обнаружена ошибка, его можно отправить заново
Используется совместно с обнаружением ошибок.
* Повторная отправка кадра, который не дошёл до получателя

Есть два варианта метода повторной отправки:
**Остановка и ожидание**
* Отправитель передаёт кадр и останавливает передачу
* Получатель отправляет подтверждение
* Отправитель передаёт новый кадр
У отправителя есть таймаут, если за время ожидания таймаут истёк и подтверждения не пришло - необходимо отправить кадр повторно.
Такая технология используется в Wi-Fi.

**Скользящее окно**
* Отправитель передаёт несколько кадров один за другим, не дожидаясь подтверждения
* Количество кадров, которое можно отправить, называется **размером окна**
* Получатель подтверждает получение кадров (для последнего полученного сообщения)
* Отправитель передаёт новую порцию кадров
(Используется на транспортном уровне в протоколе TCP)

На практике обнаруживать, исправлять ошибки и осуществлять повторную отправку данных можно на разных уровнях:
* Каналы связи с редкими ошибками (например, кабель, волокно) - на верхних уровнях
* Каналы связи с частыми ошибками (например Wi-Fi) - на канальном уровне

Модель OSI разрабатывалась для каналов связи точка-точка
(последовательные линии связи для соединения больших компьютеров)

Когда получили распространение разделяемые каналы связи, модель пришлось изменить.

Канальный уровень был разделён на два подуровня:

**Подуровень управления логическим каналом (Logical Linc Control, LLC)**
* Отвечает за передачу данных (создание кадров, обработка ошибок и т. д.)
* Общий для разных технологий

**Подуровень управления доступом к среде (Media Access Control, MAC)**
* Совместное использование разделяемой среды
* Адресация
* Специфичный для разных технологий
* Не является обязательным (для формата точка-точка, например)

Также подуровень LLC способен осуществлять:
**Мультиплексирование**
* Передача данных разных протоколов (IP, ARP, ICMP) на уровень MAC (через канальный уровень)

**Управление потоком:**
* Предотвращение "затопления" медленного получателя быстрым отправителем
(Если в сети устройства, работающие с разной скоростью, возможна ситуация, когда более быстрое и мощное устройство начинает передавать огромный и быстрый объём данных медленному получателю, "затапливая" его.

##Согласованный доступ к разделяемому каналу связи##

**Управление доступом**:
* Обеспечение использования канала только одним отправителем в один и тот же момент времени
в противном случае произойдёт **коллизия** (данные искажаются, если несколько компьютеров передают одновременно)

**Методы управления доступом**:
* Рандомизированный - из N компьютеров выбирается один с вероятностью 1/N. (Ethernet, Wi-Fi)
* На основе правил использования. (Token Ring)

#Ethernet#
Две технологии Ethernet:

**Классический Ethernet**
* Разделяемая среда
* Ethernet - Gigabit Ethernet

<details>
    <summary>Уровни:</summary>
Ethernet            10 MB/s     802.3
Fast Ethernet       100 MB/s    802.3u
Gigabit Ethernet    1 Gb/s      802.3z, 802.3ab
</details>

**Коммутируемый Ethernet**
* Точка-точка
* Появился в Fast Ethernet
* Единственный вариант в 10G Ethernet и выше

Почти всё современное оборудование поддерживает обе технологии.

##Классический Ethernet##
Исторически - самый первый.
Общая шина - коаксиальный кабель
К каждому компьютеру подключался т-коннектор, соединяющий его с общей шиной.
Минусы - разрыв в одном месте приводил к повреждению всей сети в целом.

Следующий этап технологии - **hub** или **концентратор**
Устройство для создания сетей Ethernet на основе **витой пары**

Физическая топология - **звезда**.
Логическая топология - **общая шина**, так как сигнал, поступающий на один порт концентратора передаётся на все остальные порты.

Преимущества:
если выйдет из строя кабель или сетевой адаптер - сеть перестаёт работать только на одном компьютере.
На основе цветовой индикации легко найти источник, где нет линка.

**Физический уровень Ethernet**
Технология Ethernet содержит описание передачи сигналов по трём разным типам кабелей:
* Коаксиальный
* Витая пара
* Оптоволокно

**Канальный уровень Ethernet**
* Методы доступа и протоколы, одинаковые для любой среды передачи данных
* В классическом Ethernet смешаны подуровни LLC и MAC

На канальном уровне для передачи данных используются кадры.
Есть три стандарта реализации кадра:
* Экспериментальная реализация Ethernet в Xerox (сейчас почти не используется)
* Ethernet II (Ethernet DIX) - фирменный стандарт Ethernet компаний DEC, Intel, Xerox
* IEEE 802.3 - юридический стандарт Ethernet

Стандарты Ethernet II и IEEE 802.3 незначительно отличаются друг от друга
* Ethernet II используется чаще.

#Формат кадра Ethernet
6 байт      6 байт      2 байта     46-1500 байт    4 байта
Адрес       Адрес       Тип         Данные          Контрольная сумма
получателя  отправителя документа
                        0800 - IPv4
                        86DD - IPv6
                        0806 - ARP
                        etc
Header      Header      Header      Body            Концевик

Поле данные от протокола верхнего уровня:
Максимальная длина 1500 байт,
* Выбрана разработчиками Ethernet
* Ограничение на размер памяти для буфера
* Существует расширение JumboFrame (до 9000 байт)

Минимальная длина 46 байт
* Ограничение технологии Ethernet

#MAC адреса.
Используется на подуровне канального уровня: Media Access Control
Регламентированы стандартом IEEE 802
Наиболее популярны:
Ethernet    (IEEE 802.3)
Wi-Fi       (IEEE 802.11)
**Длина MAC-адреса**
6 байт (48 бит)
**Форма записи** - шесть шестнадцатеричных чисел:
примеры:
* 1C-75-08-D2-49-45
* 1C:75:08:D2:49:45

**Типы MAC-адресов**Ж
1. Индивидуальный (unicast):
* 30-9C-23-15-E8-8C
2. Групповой (multicast, первый бит старшего байта адреса равен 1):
* 01-80-C2-00-00-08
(Передача осуществляется на группу устройств. На этих устройствах должен быть настроен multicast).
3. Широковещательный (broadcast, все 1):
* FF-FF-FF-FF-FF-FF

**Уникальность MAC-адресов**
В одном сегменте сети не должно быть одинаковых MAC-адресов.
* Одна широковещательная среда Ethernet или Wi-Fi
* Один VLAN в коммутируемом Ethernet

Если будет два компьютера с одним MAC-адресом, то один из них не будет работать
* Какой именно не регламентируется

**Способы назначения адресов**
1. Централизованный (по умолчанию) - производителем оборудования согласно стандартам IEEE 802.
2. Локальный - администратором сети, администратор обеспечивает уникальность.

Индикатор способа назначения - второй бит старшего байта MAC-адреса:
- 0 - адрес назначен централизованно
- 1 - адрес назначен локально

Структура централизованного MAC-адреса:
* Первые 3 байта - уникальный идентификатор организации (Organizationally Unique Identifier, OUI), выдаются производителям оборудования.
Примеры:
* 00:00:0C - Cisco
* 00:02:B3 - Intel
* 00:04:AC - IBM
* Последние 3 байта - назначает производитель оборудования, который отвечает за уникальность.

#Классический Ethernet. Метод CSMA/CD.
**Управление доступом к среде** реализуется посредством обеспечения использования канала только одним отправителем.

Классический Ethernet использует для этого метод CSMA/CD:
* Carrier Sense Multiple Access with Collision Detection
* Множественный доступ с прослушиванием несущей частоты и обнаружением коллизий
**Carrier Sense**
Для избежания коллизий, компьютеры передают данные только если среда свободна.
Способ определить, свободна ли среда - прослушивание основной гармоники сигнала (несущей частоты).
**Несущая частота** - основная гармоника сигнала, зависящая от среды передачи данных и используемого протокола передачи данных.
Например, смена тактовой частоты в середине каждого такта при манчестерском кодировании означает, что передача данных уже идёт.
Также может быть случай, когда тактовой частоты нет, но какой-то сигнал есть - это означает что это не сигнал передачи данных, а просто помехи.

**Collision Detection**
Если два компьютера начали передачу одновременно - происходит коллизия.

**Обнаружение коллизий:**
* Компьютер передаёт и принимает сигналы одновременно.
* Если принятый сигнал отличается от переданного - значит возникла коллизия.

Jam-последовательность - передаётся компьютером при обнаружении коллизии для того, чтобы другие компьютеры легче её распознали.
Jam-последовательность - это сигнал, который существенным образом искажает все передаваемые по сети данные, усиливая коллизию чтобы все компьютеры в разделяемой среде поняли, что произошла коллизия и остановили передачу.

В модели CSMA/CD при передаче кадра есть три периода:
1. Период передачи - один из компьютеров передаёт данные в разделяемой среде.
2. Период конкуренции - возникает, когда несколько компьютеров пытаются начать передавать данные.
3. Период простоя - никому данные передавать не нужно, среда свободна.
**Период передачи:**
Если в среде нет несущей частоты, то компьютер может начинать передачу данных.
**Схема передачи:**
Преамбула, Кадр, Межкадровый интервал

**Преамбула** позволяет отправителю и получателю синхронизироваться.
Длина 8 байт
Первые 7 байт: 10101010 - за счёт этого обеспечивается синхронизация отправителя и получателя
Последний байт: 10101011 - две последние единицы - ограничитель начала кадра - знак, что преамбула закончилась.
**Передача кадра**
В классическом Ethernet после окончания преамбулы компьютер начинает передавать кадр.
Все остальные компьютеры в сети начинают принимать кадр и записывают его в свой буфер.
Первые 6 байт кадра содержат адрес получателя:
* Компьютер, который узнал свой адрес, продолжает записывать кадр
* Остальные удаляют кадр из буфера
Есть специальный режим адаптера:
**Неразборчивый режим** (promiscuous mode):
* Адаптер принимает все кадры в сети, независимо от MAC-адреса назначения.
Часто используют для диагностики сети.
**Межкадровый интервал**:
После передачи кадра в классическом Ethernet выдерживается интервал в 9,6 мкс (микросекунд).
Это делается для предотвращения монопольного захвата канала каким-либо одним устройством
и для приведения сетевых адаптеров в исходное состояние и подготовки их к дальнейшим операциями принятия и передачи кадра.

После межкадрового интервала другие компьютеры могут начать конкурировать за передачу: происходит период конкуренции.

В период конкуренции, если компьютер начал передавать данные и обнаружил коллизию, то он делает паузу.
**Длительность паузы:** L * 512 битовых интервалов.
**Битовый интервал** - это время между появлениями двух последовательных битов данных (0,1 мкс в классическом Ethernet)
L случайно выбирается из диапазона [0, 2 в степени N - 1, где N - номер попытки.

Такой алгоритм называется **экспоненциальным** двоичным алгоритмом отсрочки.
Экспоненциальный, поскольку 2 растёт по экспоненте.
Диапазоны L:
* 1 попытка: [0, 1]
* 2 попытка: [0, 3]
* 3 попытка: [0, 7]
* 5 попытка: [0, 31]
* 10 попытка: [0, 1023]
После 10 попыток интервал не увеличивается
После 16 попыток передача прекращается

Экспоненциальный двоичный алгоритм отсрочки хорошо работает при низкой загрузке:
* Когда в сети мало компьютеров
* Когда компьютеры редко передают данные

Если нагрузка высокая, то коллизии возникают чаще:
* Растёт число попыток передачи
* Растёт интервал, из которого выбирается L, и длительность пауз
* Экспоненциально увеличивается задержка
В результате скорость передачи данных по сети существенно снижается.

**Недостатки классического Ethernet**
Плохая масштабируемость:
* Сеть становится неработоспособной при загрузке разделяемой среды больше, чем на 30%
* Работоспособное количество компьютеров - 30

Низкая безопасность:
* Данные в разделяемой среде доступны всем

Разное время доставки кадра:
* Причина - коллизии
* Плохо для трафика реального времени

Решение проблем:
* Коммутируемый Ethernet

**Типы Ethernet**
Классический Ethernet
Исторически появился первый (1973 г.)
Разделяемая среда, коллизии
Метод CSMA/CD

Коммутируемый Ethernet
Новая усовершенствованная технология (1995 г., Fast Ethernet, IEEE 802.3u)
Нет разделяемой среды
Нет коллизий
Новые устройства - коммутаторы (switch)

**Концентратор (Hub)**
имеет топологию - общая шина.
Все порты внутри соединены друг с другом.
Работает на физическом уровне:
передаёт поступающие ему электрические сигналы на все остальные порты.

**Коммутатор (Switch)**
Имеет полносвязную топологию.
Все порты соединены друг с другом на прямую по технологии "точка-точка".
Работает на канальном уровне:
анализирует заголовок канального уровня, извлекает из него адрес получателя и передаёт данные только на тот порт, к которому подключен получатель.

#Особенности работы коммутаторов
**Таблица коммутации**
* Соответствие MAC-адресов портам коммутатора

Для заполнения таблицы MAC-адресов используется
**Алгоритм обратного обучения**
* Заполнение таблицы коммутации

После того, как таблица заполнена для передачи данных используется
**Алгоритм прозрачного моста**
* Передача кадров коммутатором

**Таблица коммутации**
Содержит данные о доступности MAC-адресов через порты коммутатора.
Пример:
Порт коммутатора    MAC-адрес
        1           1C-75-08-D2-49-45
        2           00-02-B3-A7-49-D1
        3           00-04-AC-85-E7-03
В реальности таблица устроена более сложно (тип записи, номер vlan, состояние порта и т. п.)

**Алгоритм обратного обучения**
Коммутатор принимает все кадры, которые приходят на его порты,
извлекает из них заголовок канального уровня,
а оттуда - адрес отправителя.
Т. о. он записывает этот адрес в соответствие с тем портом, откуда он его извлёк.
Так происходит до тех пор, пока коммутатор не заполнит данные обо всех подключенных к его портам устройствах.

**Сетевой мост**
**Мост** - это устройство для объединения нескольких сетей.
Мосты в классическом Ethernet использовались для разделения крупных сетей на несколько маленьких сетей, внутри которых коллизий возникало гораздо меньше.
Мост принимал все кадры из пограничных сетей, но передавал их в другую сеть только если они предназначались для компьютера из другой сети.
* Предшественник коммутатора
Для коммутатора был выбран алгоритм прозрачного моста
**Прозрачный мост**:
* Не заметен для сетевых устройств (нет своего MAC-адреса)
* Не требует настройки
В таком режиме работает коммутатор: является мостом с большим количеством портов, не требует настройки.

**Алгоритм прозрачного моста**
Когда таблица коммутации заполнена, коммутатор принимает кадры, анализирует заголовок канального уровня и извлекает оттуда адрес получателя.
Ищет этот адрес в таблице коммутации и передаёт его в соответствующий адресу порт.

Если пришёл кадр с адресом получателя, которого нет в таблице MAC-адресов, то коммутатор работает как концентратор:
передаёт кадр на все порты, кроме того, откуда он поступил.

Если используется сеть, состоящая только из коммутаторов, то в такой сети коллизии не возникают
Исключения составляют полудуплексные соединения компьютеров к коммутатору. Коллизия может возникнуть, если компьютер и коммутатор одновременно решат передавать данные.

Если к порту коммутатора подключен концентратор, то этот порт подключается к общей разделяемой среде и на нём могут возникать коллизии как в классическом Ethernet.

**Особенности работы коммутаторов**
* Анализируют заголовок канального уровня
* Передают кадр только получателю
* "Изучают" сеть (алгоритм обратного обучения, таблица коммутации)

**Преимущества**
* Высокая производительность и масштабируемость
* Высокая безопасность

#VLAN

Virtual local area network (виртуальная локальная сеть)
Технология разделения единой физической сети на несколько логических сетей, изолированных друг от друга
**Место в модели OSI**
* Канальный уровень
* Коммутаторы

Использование VLAN необходимо для
**изоляции сетей**
* Разные отделы внутри крупной компании
* Разные компании в бизнес-центре и т. д.

**Преимущества изоляции сетей**
* Безопасность
* Распределение нагрузки
* Ограничение широковещательного трафика

В коммутаторах порты часто различаются разными цветами, чтобы различать VLAN, к которому они принадлежат.

Реализация в таблице коммутации - добавление нового атрибута **идентификатор VLAN**:

Порт коммутатора    MAC-адрес           VLAN
        1           1C-75-08-D2-49-45   2
        2           00-02-B3-A7-49-D1   3
        3           00-04-AC-85-E7-03   2
        4           54-BE-F7-88-15-47   3

Даже если компьютер отправителя знает MAC-адрес получателя, коммутатор не передаст данные, поскольку передача запрещена.

При передаче информации от одного коммутатора к другому возникла необходимость передавать в кадре идентификатор VLAN'a, но в классическом кадре места под это нет:

6 байт      6 байт      2 байта     46-1500 байт    4 байта
Адрес       Адрес       Тип         Данные          Контрольная сумма
получателя  отправителя документа
                        0800 - IPv4
                        86DD - IPv6
                        0806 - ARP
                        etc
Header      Header      Header      Body            Концевик

Решение было предложено в стандарте IEEE 802.1Q

6 байт      6 байт      2 байта         2 байта     2 байта     46-1500 байт    4 байта
Адрес       Адрес       Тип             Тег         Тип         Данные          Контрольная сумма
получателя  отправителя стандартного    содержит    код
                        кадра           номер       протокола
                        0x8100 -        VLAN        уровня
                        указатель,                  выше
                        что кадр с
                        VLAN
Header      Header      Header          Body        Body        Body            Концевик

До внедрения этой технологии информация о номере VLAN'a добавлялась и использовалась только коммутаторами.

Реализация стандарта IEEE 802.1Q выглядит следующим образом:
Сетевой адаптер в компьютере генерирует обычный Ethernet-кадр, внутри которого обычный IP-пакет. В поле Тип протокола следующего уровня содержится значение 0x0800.
Коммутатор получает этот кадр, понимает, что он был получен с компьютера, входящего в определённый VLAN.
Коммутатор добавляет служебные поля:
В поле "Тип протокола следующего уровня" 0x800 заменяется на 0x8100,
добавляется тег с идентификатором VLAN'a,
и затем записывается код протокола следующего уровня: 0x0800

Принимающий коммутатор видит тег с идентификатором VLAN'a,
удаляет информацию о номере VLAN и восстанавливает старые значения о протоколе следующего уровня,
пересылает кадр принимающему компьютеру.

**Типы VLAN**
* Нетегированные - номер VLAN в таблице коммутации
Используется внутри одного коммутатора
* Тегированные - номер VLAN в кадре (стандарт IEEE 802.1Q)
Используются если сеть состоит из нескольких коммутаторов

#STP Protocol
При кольцевом соединении коммутаторов возникает широковещательный шторм.

**Протокол связующего (остовного) дерева**
(Spanning Tree Protocol, STP)
позволяет автоматически отключать дублирующие соединения в Ethernet, чтобы в сети не образовалось кольца и широковещательного шторма.
* Связующее (остовное) дерево - подграф без циклов, содержащий все вершины исходного графа.

Протокол STP определен в стандарте IEEE 802.1D

**Преимущества STP**
* Надёжность соединений между коммутаторами.
* Защита от ошибок конфигурации.
Защищает от случайного подключения коммутаторов в кольцевое соединение:
Соединение будет отключено на программном уровне.

**Этапы работы протокола**
Протокол STP работает в 3 этапа:
1. Выбор корневого коммутатора
2. Определение кратчайших путей до корневого коммутатора
3. Отключение всех остальных соединений

Для реализация STP коммутаторы каждые 2 секунды отправляют управляющие сообщения Bridge Protocol Data Units (BPDU) на групповой адрес STP:
* 01:80:C2:00:00:00.

**Выбор корневого коммутатора**
Выбор происходит по идентификатору коммутатора: выбирается минимальный.
По умолчанию в качестве идентификатора используется MAC-адрес коммутатора.
Но можно повлиять на выбор вручную, чтобы выбрать в качестве корневого коммутатора самый мощный.

На первом этапе коммутаторы не знают друг о друге и каждый считает себя корневым и рассылает всем связанным коммутаторам сообщение о том, что он - корневой коммутатор.
Получив сообщения от своих соседей, коммутаторы сравнивают BID в сообщении со своим BID (Bridge ID).
На следующем этапе коммутаторы будут рассылать сообщение не со своим BID, а с BID коммутатора, которого они признали корневым.

**Расчёт кратчайших путей**
После выбора корневого коммутатора, все остальные рассчитывают кратчайшие пути до него

Длина пути между коммутаторами определяется двумя параметрами:
* Количество промежуточных коммутаторов
* Скорость соединений

Коммутаторы рассылают на все порты BPDU с минимальным расстоянием до корневого коммутатора:
Предположим, что соединение между коммутаторами 1 Gbit/s. Тогда расстояние между ними согласно стандарту равно четырём:

Скорость соединения     Стоимость соединения в STP IEEE 802.1D
    4 Mbit/s                            250
    10 Mbit/s                           100
    16 Mbit/s                           62
    100 Mbit/s                          19
    1 Gbit/s                            4
    2 Gbit/s                            3
    10 Gbit/s                           2

1. Коммутаторы, непосредственно подключённые к корневому коммутатору, определяют скорость соединения с этим коммутатором и выбирают соответствующее значение расстояния.
2. Затем это кратчайшее расстояние рассылается следующим непосредственно подключённым коммутаторам.
3. Они берут это значение, определяют скорость соединения с коммутаторами, передавшими им это значение и определяют суммарное расстояние.
Так мы узнаём расстояние от всех портов до корневого коммутатора.

**Отключение лишних соединений**
Если есть кольцевое соединение, то одно из соединений отключается на этом этапе по следующей логике:
отключается либо соединение, имеющее наибольшее расстояние,
либо отключается тот порт, который имеет наибольшее значение порта.

В этот момент образуется связующее дерево, циклов нет.
При этом если одно из соединений разорвётся, то выключенное соединение снова начнёт работать, как имеющее наименьшее расстояние.

Если мы используем протокол STP, то при подключении устройства к коммутатору нельзя сразу же начинать передавать данные, потому что на новом соединении может оказаться коммутатор и отправка сообщения может привести к созданию кольца и широковещательному шторму.
Для того, чтобы избежать этого, в протоколе STP используются несколько режимов работы портов.

**Состояние портов в STP**
**Listening** - порт обрабатывает BPDU, но не передаёт данные. Начальная стадия подключения.
**Learning** - порт не передаёт кадры, но изучает MAC-адреса в поступающих кадрах и формирует таблицу коммутации. Это второй этап.
**Forwarding** - порт принимает и передаёт кадры данных и BPDU.
**Blocking** - порт заблокирован на программном уровне, чтобы избежать кольцевого соединения.
**Disabled** - порт выключен администратором.

Переход от состояния Listening до Forwarding занимал около 30 секунд в 80-ых годах.
Достаточно долго для современных крупных и часто меняющихся сетей.

**Расширения протокола STP**
RSTP (Rapid Spanning Tree Protocol):
* Улучшенная версия STP
* Срабатывает быстрее при подключении оборудования и изменении конфигурации сети
* Стандарт IEEE 802.1w

**STP и VLAN**
По умолчанию протокол STP не учитывает технологию VLAN:
вы можете создать несколько соединений между коммутаторами, которые будут принадлежать разным VLAN'ам, но Spanning Tree в исходном варианте ничего не знает про VLAN'ы, поэтому часть соединений будет отключена.
Для того, чтобы использовать протокол Spanning Tree с технологией VLAN, необходимо, чтобы остовное дерево строилось для каждого VLAN'a отдельно.
Эту возможность реализовали в стандарте IEEE 802.1s:
* Multiple Spanning Tree Protocol (MSTP), IEEE 802.1s
* Отдельное связующее дерево для каждого VLAN

#Wi-Fi
Wi-Fi - доминирующая технология беспроводной передачи данных в локальных сетях.
Торговая марка, принадлежит компании Wi-Fi Alliance.
Технология Wi-Fi описана в стандартах серии IEEE 802.11.

Ранний вариант расшифровки:
"Wireless Fidelity" - беспроводная точность.
Но сейчас считается, что это игра слов с Hi-Fi - высокая точность.

Для того, чтобы производитель мог назвать своё оборудование Wi-Fi, он должен сдать его на проверку в компанию Wi-Fi Alliance.
Wi-Fi Alliance проверяет оборудование на совместимость со стандартом.
* Только после проверки можно использовать символ Wi-Fi
* Для Ethernet такая проверка не производится.

В модели OSI Wi-Fi находится на физическом и канальном уровне.
В канальном уровне используются два подуровня (Logical Link Control, Media Access Control)

Wi-Fi может работать в двух режимах:
* Инфраструктурный
Характеризуется наличием беспроводного оборудования, т. н. точки доступа, которые подключаются к проводной сети и затем к интернету.
* Одноранговая сеть
Компьютеры взаимодействуют без точек доступа напрямую друг с другом.

**Технология Wi-Fi очень похожа на Ethernet**

Можно сказать, что это Ethernet, адаптированный к беспроводной среде:
Адресация:
* MAC-адреса.
Для передачи данных разделяемая среда:
* Радиоэфир.
И у Wi-Fi и у Ethernet общий формат кадра уровня LLC:
* Стандарт IEEE 802.2
Хотя в процессе передачи по беспроводной среде на уровне MAC Wi-Fi используется другой формат кадра.

**Стандарты физического уровня Wi-Fi**
Название            Год принятия    Скорость        Частота
802.11                  1997           1 и 2 Мб/с   2,4 ГГц
802.11a                 1999           54 Мб/с      5 ГГц
802.11b                 1999           11 Мб/с      2,4 ГГц
802.11g                 2003           54 Мб/с      2,4 ГГц
802.11n                 2009           600 Мб/с     2,4 и 5 ГГц
                                       150 Мб/с одна станция
802.11ac                2014           6.77 Гб/с    5 ГГц
                                       1.69 Гб/с одна станция

Wi-Fi использует для передачи данных электромагнитное излучение и радиоэфир:
2,4 ГГц – 802.11, 802.11b, 802.11g, 802.11n
5 ГГц – 802.11a, 802.11n, 802.11ac
Но в первом стандарте 802.11 использовалось инфракрасное излучение.

Диапазон 2,4 и 5 ГГц не требуют лицензирования:
* Можно использовать свободно
* Другие устройства также используют этот диапазон и создают помехи

**Современные стандарты Wi-Fi используют метод OFMD**
Orthogonal Frequency Division Multiplexing (мультиплексирование с ортогональным частотным разделением).

При этом данные передаются параллельно на разных частотах.
В диапазоне 2.4 ГГц для передачи данных используется 14 каналов.
Их частоты:
Канал   Частота (ГГц)
1           2.412
2           2.417
3           2.422
4           2.427
5           2.432
6           2.437
7           2.442
8           2.447
9           2.452
10          2.457
11          2.462
12          2.467
13          2.472
14          2.484

Каналы немного сдвинуты друг относительно друга, но всё равно частично перекрываются.
Таким образом количество Wi-Fi сетей, которые находятся в одном и том же месте, ограничены количеством каналов.
Если в одной и той же области будет работать больше, чем 14 сетей, им не хватит каналов.
Такая ситуация известна как **"Wi-Fi джунгли"** и она довольно часто встречается, например, в жилых домах.

Wi-Fi может использовать каналы разной ширины: 20, 40, 80 или 160 МГц.
* 20 МГц - первые стандарты Wi-Fi
* 40 МГц - 802.11n
* 80 МГц - 802.11ac (поддержка обязательна)
* 160 МГц - 802.11ac (поддержка по желанию)

**Ширина канала** - это разница между минимальной и максимальной частотой, на которые можно передавать данные.
Чем шире канал - тем более качественно мы можем передавать данные и тем выше скорость передачи данных.

В стандарте 802.11n появилась возможность использовать 40 МГц и за счёт этого увеличивать скорость передачи.
Начиная с этого стандарта появилась возможность использовать несколько антенн для передачи и приёма сигнала.
Если у нас есть несколько антенн, то мы можем использовать несколько пространственных потоков.
**Пространственный поток** - сигнал, распространяющийся от одной антенны до другой.
Параллельная передача нескольких пространственных потоков существенно увеличивает скорость передачи данных.
При этом используется специальный метод кодирования сигналов: MIMO - **Multiple Input Multiple Output**.

**Адаптация скорости**
В Ethernet скорость передачи данных фиксирована.

Wi-Fi позволяет менять скорость при разном качестве сигнала:
* Высокое качество - скорость увеличивается
* Низкое качество - скорость уменьшается

Для того, чтобы уменьшить или увеличить скорость Wi-Fi меняет несколько параметров.
Адаптация скорости реализуется за счёт изменения:
* "Ширины" используемых каналов (20 - 160 МГц)
* Методов модуляции (Modulation type: BPSK, QPSK, 16-QAM, 64-QAM, 256-QAM)
* Интервала между сигналами (Guard Interval - интервал данных между символами, которые передаются по Wi-Fi, измеряется в наносекундах 800 ns - 400 ns)

#Wi-Fi. Управление доступом к разделяемой среде
Физический уровень Wi-Fi использует 6 стандартов IEEE 802.11
Канальный уровень Wi-Fi одинаковый для разных стандартов физического уровня.

Wi-Fi использует для передачи данных разделяемую среду - радиоэфир.
В разделяемой среде возможны коллизии.
Чтобы их избежать, необходим метод доступа к среде, который бы обеспечивал, что в один момент времени данные передает только один компьютер.

**Особенности беспроводной среды**
* Вероятность ошибки передачи данных выше, чем в проводной среде
* Мощность передаваемого сигнала намного выше, чем принимаемого
* Ограниченный диапазон распространения сигнала – не все компьютеры в сети получают данные.
Проблема скрытой станции - один компьютер расположен в зоне пересечения действия сразу двух компьютеров, которые друг друга не видят.
Проблема засвеченной станции - один компьютер в зоне действия существующей передачи видит компьютер за этой зоной действия, но не передаёт данные, так как его среда занята.

Так как ошибки при передаче данных возникают часто, то в Wi-Fi на канальном уровне используется подтверждение получения передаваемых данных.
Коллизии в Wi-Fi обнаруживаются по отсутствию подтверждений. 

**Обнаружение коллизий**
**Ethernet**
* Компьютер передаёт и одновременно принимает сигнал. При сравнении сигналов, если они отличаются - произошла коллизия.
* Jam-последовательность для усугубления коллизии

**Wi-Fi**
* Передаваемый сигнал намного мощнее принимаемого
* Проблемы скрытой и засвеченной станции
* Сигнал о коллизии может не дойти до всех компьютеров

Коллизии в Ethernet дёшевы
* Обнаруживаются сразу после возникновения
* Все компьютеры останавливают передачу данных

Коллизия в Wi-Fi обходится очень дорого
* Требуются большие временные затраты на обнаружение:
1. Время передачи кадра
2. Время тайм-аута ожидания подтверждения

Поэтому в Wi-Fi используется метод CSMA/CA - ножественный доступ с прослушиванием несущей частоты с предотвращением коллизий.

**Методы доступа к среде в Ethernet:**
* CSMA/CD - Множественный доступ с прослушиванием несущей частоты и распознаванием коллизий

**Метод доступа к среде в Wi-Fi:**
* CSMA/CA - Множественный доступ с прослушиванием несущей частоты с предотвращением коллизий (Collision Avoidance)

**Модель CSMA/CA**
Также как и в **Ethernet** перед началом передачи данных компьютеры **Wi-Fi** прослушивают несущую частоту.
Если происходит передача данных, то все остальные компьютеры ожидают завершения передачи данных.
В отличие от Ethernet в **Wi-Fi** после **передачи кадра** и **короткого межкадрового интервала** происходит **передача подтверждения (ACK)**.
После этого все компьютеры, которые хотят передавать данные должны выдержать **межкадровый интервал**.
В **Ethernet** после завершения межкадрового интервала начинается период конкуренции.
Но в **Wi-Fi**, так как коллизии обходятся очень дорого, вместо периода конкуренции используется **период молчания**.
Каждый компьютер выбирает разное время для периода молчания. Случайным образом генерируется некоторое число **слотов ожидания**.
**Слот ожидания** - это промежуток времени, в течение которого компьютер ждёт.
Длина слота ожидания разная для различных стандартов физического уровня Wi-Fi.
Количество слотов ожидания выбирается компьютерами случайным образом.
Первым начинает передавать данные тот компьютер, который выбрал меньше всего слотов ожидания.

Однако метод доступа CSMA/CA не решает проблему скрытой и засвеченной станции.

Другой метод доступа к среде в Wi-Fi:
**протокол Multiple Access with Collision Avoidance (MACA).**
Он позволяет решить проблему скрытой и засвеченной станции.
Однако на практике метода CSMA/CA почти всегда достаточно, поэтому поддержка протокола MACA в оборудовании Wi-Fi не обязательна.

**Протокол MACA**
Перед передачей данных компьютер передаёт управляющее сообщение:
* Request To Send (RTS)
* Включает размер сообщения с данными

Принимающий компьютер отвечает сообщением:
* Clear To Send (CTS)
* Также включает размер ожидаемого сообщения

Компьютеры, увидевшие CTS, ждут:
* Время на передачу данных (размер данных в CTS)
* Время на передачу подтверждения

