Параметры Kubernetes securityContext определены как в PodSpec, так и в ContainerSpec.<br>
Если параметр доступен и настроен в обеих областях, параметр контейнера будет иметь приоритет.<br>

Пример минимальных требований безопасности по пути spec.containers[\*].securityContext:
```
securityContext:
  capabilities:
    drop:
    - ALL
  runAsUser: 1001
  runAsGroup: 2000
  runAsNonRoot: true
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  seccompProfile:
    type: RuntimeDefault
```
**Разбор этих параметров.**<br>
[readOnlyRootFilesystem](#readonlyrootfilesystem)<br>
[runAsNonRoot](#runasnonroot)<br>
[runAs](#runas)<br>
[capabilities](#capabilities)<br>
[seccompProfile](#seccompprofile)<br>

### readOnlyRootFilesystem
**securityContext.readOnlyRootFilesystem: true**<br>
Всегда устанавливать этот параметр в true, если это возможно.<br>
В случае если контейнер будет скомпрометирован, read-write fs более уязвима для установки ПО злоумышленниками или изменения конфигурационных файлов.<br>
По этим же причинам следует принять во внимание, что все смонтированные volume находится в read-only формате.<br>

### runAsNonRoot
**runAsNonRoot: true**<br>
Всегда ставить в true, чтобы принудительно запускать контейнеры внутри пода в non-root user режиме.

### runAs
**runAsUser: xxxx**<br>
**runAsGroup: xxxx**<br>

Эти настройки могут быть использованы для установления принудительного окружения используемых uid и gid.<br>
(Подробнее про id смотрите [здесь](id_linux.md)).<br>
Данный параметр следует использовать с осторожностью, поскольку эти id должны существовать в образе контейнера и не следует использовать их как замену **runAsNonRoot**.<br>

### capabilities
```
capabilities:
  drop:
    - ALL
```
Capabilities - это разрешения на уровне ядра, которые позволяют точечно управлять этими разрешениями на различные вызовы ядра.<br>
См. статью о том что это такое подробно, например, [здесь](https://habr.com/ru/companies/otus/articles/471802/)<br>

**Capabilities** - это средства для управления привилегиями, которые в традиционных Unix-подобных системах были доступны только процессам, запущенным с правами root (uid == 0).  Этот механизм позволяет дать процессу права на выполнение каких-либо действий, недоступных обычному пользователю (например, изменение системного времени, прямой доступ к аппаратуре, использование зарезервированных портов TCP/UDP (< 1024), блокировка страниц в физической памяти), но в то же время не предоставлять этому процессу полный набор прав root. Например, процесс ntpd выполняется с правами псевдопользователя (и к тому же в chroot), но благодаря наличию привилегии CAP_SYS_TIME имеет возможность модифицировать системное время.<br>
Источник: https://www.altlinux.org/Capabilities<br>

В kubernetes securityContext отдельные сapabilities или список, разделенный запятыми, могут быть представлены в виде массива строк.<br>
Кроме того, вы можете использовать сокращение -all для добавления или удаления всех capabilities. Эта конфигурация передается в среду выполнения контейнеров и настраивает capabilities при создании контейнера. Если в securityContext нет раздела capabilities, тогда контейнер создается с набором capabilities по умолчанию, который предоставляет среда выполнения контейнера.<br>
Рекомендуется отказаться от всех capabilities, а затем добавить обратно только те, которые действительно нужны вашему приложению. Во многих случаях приложениям на самом деле не требуются какие-либо capabilities при нормальной работе. Вначале отключите все capabilities и отслеживайте сбои в журнале аудита, чтобы увидеть, какие из них были заблокированы.<br>

Обратите внимание, что при перечислении capabilities в securityContext вы удаляете префикс CAP\_, который ядро использует в именах capabilities. Вы можете использовать утилиту capsh, она выводит информацию о включенных в контейнере capabilities в удобном формате о том, но оставляйте эту утилиту в итоговых контейнерах, так как это позволяет злоумышленнику легко определить, какие capabilities включены! Вы также можете проверить включенные capabilities в файле /proc/1/ status.<br>

**allowPrivilegeEscalation: false**<br>

Отключение эскалации привилегий.<br>
В общем случае эскалация привилегий — это получение прав в системе выше, чем у тебя уже есть.<br>
Это значение рекомендуется ставить именно таким ещё от best practice kubernetes в целом.<br>
(см. https://kubernetes.io/docs/concepts/security/pod-security-standards/)

### seccompProfile
**Параметры Seccomp профиля.**
Seccomp является функцией ядра Linux, которая может ограничивать вызовы, которые конкретный процесс может делать из пользовательского пространства в ядро.<br>

В природе доступно три значения для поля type, при этом при значении localhost необходимо указывать дополнительный параметр:<br>
localhostProfile, где должен быть указан путь к профилю seccomp.<br>
Профиль seccomp - это определение JSON, обычно состоящее из набора системных вызовов и действия по умолчанию, предпринимаемого при возникновении одного из этих системных вызовов.<br>

Рекомендуемые значения:<br>
* RuntimeDefault
* Localhost

```
seccompProfile:
  type: RuntimeDefault
```

Источник:
https://habr.com/ru/articles/549076/
